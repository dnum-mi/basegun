describe('Get Basegun result', () => {
  it('should have dummy button enabled', () => { 
    cy.visit('/')
    cy.get('.swiper-button-next').click()
    cy.get('#position-button')
      .contains('J\'ai compris')
      .click()
    cy.url()
      .should('contain', '/accueil')
    cy.getByDataTestid('start')
      .contains('Démarrer')
      .click()
    cy.url()
      .should('contain', '/instructions')
    cy.contains('h3', 'Pour un résultat optimal')
    cy.contains('span', 'canon vers la droite')

    cy.getByDataTestid('select-file').as('fileInput')
    cy.intercept('POST','/api/upload').as('upload')
    cy.get('@fileInput').selectFile('./cypress/images/pistolet-semi-auto.jpg', { force: true })
    cy.wait('@upload').then(({ response }) => {
      expect(response.statusCode).to.eq(200)
    })
      cy.url().should('contain','/resultat')
      cy.getByDataTestid('legal-category').contains('Catégorie B')
      cy.getByDataTestid('dummy-button')
        .should('be.enabled')
        .contains('Vérifier si l\'arme est factice')
  })

  it('should have dummy button disabled', () => { 
    cy.visit('/instructions')
    cy.getByDataTestid('select-file').as('fileInput')
    cy.intercept('POST','/api/upload').as('upload')
    cy.get('@fileInput').selectFile('./cypress/images/pistolet-ancien-a-percussion-monocoup.jpg', { force: true })
    cy.wait('@upload').then(({ response }) => {
      expect(response.statusCode).to.eq(200)
    })
      cy.url().should('contain','/resultat')
      cy.getByDataTestid('legal-category').contains('D')
      cy.getByDataTestid('dummy-button')
        .should('be.disabled')
        .contains('Pas de guide de vérification')
    })
})